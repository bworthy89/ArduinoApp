<?xml version="1.0" encoding="utf-8"?>
<!-- TestingPage.xaml - Real-time input testing with visual feedback -->
<Page
    x:Class="ArduinoConfigApp.Views.TestingPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:ArduinoConfigApp.ViewModels"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header with controls -->
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock Text="Input Testing" Style="{StaticResource TitleTextBlockStyle}"/>
                <TextBlock Text="Test your inputs in real-time with visual feedback"
                           Style="{StaticResource SubtitleTextBlockStyle}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                <!-- Connection indicator -->
                <StackPanel Orientation="Horizontal" Margin="0,0,16,0">
                    <Ellipse Width="10" Height="10"
                             Fill="{x:Bind ViewModel.ConnectionState, Mode=OneWay, Converter={StaticResource ConnectionStateToColorConverter}}"/>
                    <TextBlock Text="{x:Bind ViewModel.ConnectionState, Mode=OneWay}" Margin="8,0,0,0"/>
                </StackPanel>

                <!-- Testing controls -->
                <Button Content="Start Testing"
                        Style="{StaticResource AccentButtonStyle}"
                        Command="{x:Bind ViewModel.StartTestingCommand}"
                        Visibility="{x:Bind ViewModel.IsTestingActive, Mode=OneWay, Converter={StaticResource BoolToVisibilityInverseConverter}}"/>
                <Button Content="Stop Testing"
                        Command="{x:Bind ViewModel.StopTestingCommand}"
                        Visibility="{x:Bind ViewModel.IsTestingActive, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>
            </StackPanel>
        </Grid>

        <!-- Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Input States Grid -->
            <Border Grid.Column="0"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="20"
                    Margin="0,0,12,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Section Header -->
                    <TextBlock Grid.Row="0"
                               Text="Input States"
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               Margin="0,0,0,16"/>

                    <!-- Input States List -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <ItemsRepeater ItemsSource="{x:Bind ViewModel.InputStates, Mode=OneWay}">
                            <ItemsRepeater.Layout>
                                <UniformGridLayout MinItemWidth="200"
                                                   MinItemHeight="120"
                                                   MinColumnSpacing="12"
                                                   MinRowSpacing="12"/>
                            </ItemsRepeater.Layout>
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate x:DataType="vm:InputStateViewModel">
                                    <Border Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                                            BorderBrush="{x:Bind IsActive, Mode=OneWay, Converter={StaticResource BoolToAccentBorderConverter}}"
                                            BorderThickness="2"
                                            CornerRadius="8"
                                            Padding="16">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <!-- Input Name and Type -->
                                            <StackPanel Grid.Row="0">
                                                <TextBlock Text="{x:Bind Name, Mode=OneWay}"
                                                           FontWeight="SemiBold"/>
                                                <TextBlock Text="{x:Bind InputType, Mode=OneWay}"
                                                           FontSize="12"
                                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                            </StackPanel>

                                            <!-- Visual State Indicator -->
                                            <Grid Grid.Row="1" Margin="0,12">
                                                <Ellipse Width="40" Height="40"
                                                         Fill="{x:Bind StateColor, Mode=OneWay}"
                                                         HorizontalAlignment="Center"/>
                                                <!-- For encoders, show value -->
                                                <TextBlock Text="{x:Bind Value, Mode=OneWay}"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           FontWeight="Bold"
                                                           Foreground="White"
                                                           Visibility="{x:Bind InputType, Mode=OneWay, Converter={StaticResource EncoderTypeToVisibilityConverter}}"/>
                                            </Grid>

                                            <!-- Stats -->
                                            <StackPanel Grid.Row="2" Orientation="Horizontal">
                                                <TextBlock Text="Triggers: " FontSize="11"
                                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                                <TextBlock Text="{x:Bind TriggerCount, Mode=OneWay}"
                                                           FontSize="11"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </ScrollViewer>

                    <!-- Display Preview -->
                    <StackPanel Grid.Row="2" Margin="0,16,0,0">
                        <TextBlock Text="Display Preview" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <ItemsRepeater ItemsSource="{x:Bind ViewModel.DisplayStates, Mode=OneWay}">
                            <ItemsRepeater.Layout>
                                <StackLayout Orientation="Horizontal" Spacing="16"/>
                            </ItemsRepeater.Layout>
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate x:DataType="vm:DisplayStateViewModel">
                                    <Border Background="#111111"
                                            CornerRadius="4"
                                            Padding="12,8">
                                        <StackPanel>
                                            <TextBlock Text="{x:Bind Name, Mode=OneWay}"
                                                       FontSize="10"
                                                       Foreground="#666666"/>
                                            <!-- 7-Segment Style Display -->
                                            <TextBlock Text="{x:Bind FormattedValue, Mode=OneWay}"
                                                       FontFamily="Consolas"
                                                       FontSize="28"
                                                       Foreground="#FF0000"
                                                       FontWeight="Bold"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Event Log -->
            <Border Grid.Column="1"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="20"
                    Margin="12,0,0,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <Grid Grid.Row="0" Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0"
                                   Text="Event Log"
                                   Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <Button Grid.Column="1"
                                Content="Clear"
                                Command="{x:Bind ViewModel.ClearEventLogCommand}"/>
                    </Grid>

                    <!-- Event List -->
                    <ListView Grid.Row="1"
                              ItemsSource="{x:Bind ViewModel.EventLog, Mode=OneWay}"
                              SelectionMode="None">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <TextBlock Text="{x:Bind}"
                                           FontFamily="Consolas"
                                           FontSize="11"
                                           TextWrapping="Wrap"/>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <!-- Stats -->
                    <StackPanel Grid.Row="2" Margin="0,16,0,0">
                        <TextBlock Text="{x:Bind ViewModel.LastEvent, Mode=OneWay}"
                                   FontSize="12"
                                   TextTrimming="CharacterEllipsis"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBlock Margin="0,4,0,0" FontSize="12">
                            <Run Text="Total Events: "/>
                            <Run Text="{x:Bind ViewModel.EventCount, Mode=OneWay}" FontWeight="SemiBold"/>
                        </TextBlock>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Page>
